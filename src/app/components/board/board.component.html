<div class="board-container">
  <div class="board-header">
    <h1>Kanban Board</h1>

    <div class="filters">
      <div class="filter">
        <label for="assignee-filter">Assignee</label>
        <select id="assignee-filter" (change)="onAssigneeFilter($event)">
          <option value="">All Assignees</option>
          @for (assignee of uniqueAssignees(); track assignee) {
            <option [value]="assignee">{{ assignee || 'Unassigned' }}</option>
          }
        </select>
      </div>

      <div class="filter">
        <label for="priority-filter">Priority</label>
        <select id="priority-filter" (change)="onPriorityFilter($event)">
          <option value="">All Priorities</option>
          @for (priority of uniquePriorities(); track priority) {
            <option [value]="priority">{{ priority }}</option>
          }
        </select>
      </div>

      <div class="filter">
        <label for="tag-filter">Tag</label>
        <select id="tag-filter" (change)="onTagFilter($event)">
          <option value="">All Tags</option>
          @for (tag of uniqueTags(); track tag) {
            <option [value]="tag">{{ tag }}</option>
          }
        </select>
      </div>
    </div>

    <button class="add-task-btn" (click)="openCreateTask()">+ Add Task</button>
  </div>

  <div class="board-columns">
    @for (column of dataService.columns(); track column.id) {
      <div class="column">
        <div class="column-header">
          <h2>{{ column.title }}</h2>
          <span class="task-count">
            {{ getColumnTasks(column.id).length }} / {{ column.wipLimit }}
          </span>
        </div>

        <div class="column-content"
             cdkDropList
             [id]="column.id"
             [cdkDropListData]="getColumnTasks(column.id)"
             [cdkDropListConnectedTo]="columnIds()"
             (cdkDropListDropped)="onDrop($event)">
          @for (task of getColumnTasks(column.id); track task.id) {
            <div class="task-card"
                 cdkDrag
                 [cdkDragData]="task.id">
              <div class="task-header">
                <div class="task-priority"
                     [style.backgroundColor]="task.priority === 'P1' ? '#ff5252' : task.priority === 'P2' ? '#ffab40' : '#66bb6a'">
                  {{ task.priority }}
                </div>
                <div class="task-actions">
                  <button class="edit-btn" (click)="openEditTask(task)">Edit</button>
                </div>
              </div>
              <h3 class="task-title">{{ task.title }}</h3>
              <p class="task-description">{{ task.description }}</p>
              @if (task.assignee) {
                <div class="task-assignee">Assigned to: {{ task.assignee }}</div>
              }
              @if (task.tags && task.tags.length > 0) {
                <div class="task-tags">
                  @for (tag of task.tags; track tag) {
                    <span class="tag">{{ tag }}</span>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>

@if (showEditModal) {
  <div class="modal-overlay">
    <app-edit
      [mode]="editMode"
      [task]="selectedTask"
      (save)="onTaskSave($event)"
      (cancel)="closeModal()"
    ></app-edit>
  </div>
}

